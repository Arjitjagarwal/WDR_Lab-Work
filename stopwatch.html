<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stopwatch</title>
  <style>
    :root{
      --bg:#0f1724;     /* deep navy */
      --card:#0b1220;
      --accent:#6ee7b7; /* mint */
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(110,231,183,0.06), transparent 8%),
        radial-gradient(800px 400px at 90% 90%, rgba(99,102,241,0.04), transparent 6%),
        var(--bg);
      color:#e6eef8;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }

    .card{
      width:100%;
      max-width:520px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding:28px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }
    h1{font-size:1.1rem; margin:0; letter-spacing:0.3px}
    p.sub{margin:0; color:var(--muted); font-size:0.85rem}

    .display{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      background:var(--glass);
      border-radius:12px;
      margin-bottom:16px;
      font-weight:700;
      font-size:2.4rem;
      letter-spacing:1px;
      user-select:none;
    }

    .controls{
      display:flex;
      gap:10px;
      margin-bottom:14px;
      flex-wrap:wrap;
    }
    button{
      border:0;
      padding:10px 14px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      min-width:96px;
      transition:transform .08s ease, box-shadow .08s ease;
      box-shadow: 0 4px 14px rgba(2,6,23,0.45);
      background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      color:inherit;
    }
    button:active{transform:translateY(1px)}
    .start{background:linear-gradient(180deg, rgba(110,231,183,0.16), rgba(110,231,183,0.06)); color:var(--bg)}
    .stop{background:linear-gradient(180deg, rgba(253,186,116,0.12), rgba(253,186,116,0.03)); color:#ffd7b5}
    .reset{background:transparent; border:1px solid rgba(255,255,255,0.04)}
    .lap{background:transparent; border:1px solid rgba(255,255,255,0.04)}

    .info{font-size:0.82rem; color:var(--muted); margin-bottom:12px}

    .laps{
      max-height:200px;
      overflow:auto;
      border-radius:8px;
      padding:8px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border:1px solid rgba(255,255,255,0.02);
    }
    .lap-row{
      display:flex;
      justify-content:space-between;
      padding:8px 10px;
      border-bottom:1px dashed rgba(255,255,255,0.02);
      align-items:center;
      color:var(--muted);
      font-size:0.95rem;
    }
    .lap-row:last-child{border-bottom:0}
    .empty{color:var(--muted); text-align:center; padding:14px 6px}

    @media (max-width:420px){
      .display{font-size:1.8rem; padding:20px}
      button{min-width:unset; padding:10px}
    }
  </style>
</head>
<body>
  <main class="card" role="application" aria-label="Stopwatch">
    <header>
      <div>
        <h1>Stopwatch</h1>
        <p class="sub">Accurate timer with laps & keyboard shortcuts</p>
      </div>
      <div style="text-align:right">
        <div style="font-size:0.85rem; color:var(--muted)">Space = Start/Stop</div>
        <div style="font-size:0.75rem; color:var(--muted)">L = Lap  Â·  R = Reset</div>
      </div>
    </header>

    <div id="display" class="display" role="timer" aria-live="polite">00:00.000</div>

    <div class="controls" role="group" aria-label="Stopwatch controls">
      <button id="startStop" class="start" aria-pressed="false">Start</button>
      <button id="lapBtn" class="lap" title="Lap (L)" disabled>Lap</button>
      <button id="resetBtn" class="reset" title="Reset (R)">Reset</button>
    </div>

    <div class="info">Elapsed time shown in <strong>MM:SS.mmm</strong></div>

    <div class="laps" id="laps" aria-label="Lap times">
      <div class="empty">No laps yet</div>
    </div>
  </main>

  <script>
    // Accurate stopwatch using performance.now() + requestAnimationFrame
    (function(){
      const display = document.getElementById('display');
      const startStopBtn = document.getElementById('startStop');
      const lapBtn = document.getElementById('lapBtn');
      const resetBtn = document.getElementById('resetBtn');
      const lapsEl = document.getElementById('laps');

      let running = false;
      let startTime = 0;        // performance.now() when started
      let elapsedBefore = 0;    // ms accumulated when paused
      let rafId = null;
      let lastFrame = 0;
      let lapList = [];

      function formatTime(ms) {
        // ms: number (milliseconds)
        // produce MM:SS.mmm
        const totalMs = Math.floor(ms);
        const minutes = Math.floor(totalMs / 60000);
        const seconds = Math.floor((totalMs % 60000) / 1000);
        const milliseconds = totalMs % 1000;
        const mm = String(minutes).padStart(2,'0');
        const ss = String(seconds).padStart(2,'0');
        const mmm = String(milliseconds).padStart(3,'0');
        return `${mm}:${ss}.${mmm}`;
      }

      function update() {
        const now = performance.now();
        const elapsed = elapsedBefore + (running ? now - startTime : 0);
        // update display only when value changed to limit repaints
        const formatted = formatTime(elapsed);
        display.textContent = formatted;
        lastFrame = now;
        if (running) rafId = requestAnimationFrame(update);
      }

      function start() {
        if (running) return;
        running = true;
        startTime = performance.now();
        startStopBtn.textContent = 'Stop';
        startStopBtn.classList.remove('start'); startStopBtn.classList.add('stop');
        startStopBtn.setAttribute('aria-pressed', 'true');
        lapBtn.disabled = false;
        rafId = requestAnimationFrame(update);
      }

      function stop() {
        if (!running) return;
        running = false;
        // accumulate elapsed
        const now = performance.now();
        elapsedBefore += now - startTime;
        cancelAnimationFrame(rafId);
        rafId = null;
        startStopBtn.textContent = 'Start';
        startStopBtn.classList.remove('stop'); startStopBtn.classList.add('start');
        startStopBtn.setAttribute('aria-pressed', 'false');
        lapBtn.disabled = true;
        update(); // final render
      }

      function reset() {
        running = false;
        startTime = 0;
        elapsedBefore = 0;
        if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
        lapList = [];
        display.textContent = '00:00.000';
        lapsEl.innerHTML = '<div class="empty">No laps yet</div>';
        startStopBtn.textContent = 'Start';
        startStopBtn.classList.remove('stop'); startStopBtn.classList.add('start');
        startStopBtn.setAttribute('aria-pressed', 'false');
        lapBtn.disabled = true;
      }

      function recordLap() {
        const now = performance.now();
        const elapsed = elapsedBefore + (running ? now - startTime : 0);
        const lapTime = elapsed;
        const lapNumber = lapList.length + 1;
        lapList.unshift({num: lapNumber, time: lapTime}); // newest first
        renderLaps();
      }

      function renderLaps() {
        if (lapList.length === 0) {
          lapsEl.innerHTML = '<div class="empty">No laps yet</div>';
          return;
        }
        // Build rows (newest first)
        const frag = document.createDocumentFragment();
        lapList.forEach(l => {
          const row = document.createElement('div');
          row.className = 'lap-row';
          const left = document.createElement('div');
          left.textContent = `Lap ${l.num}`;
          const right = document.createElement('div');
          right.textContent = formatTime(l.time);
          row.appendChild(left);
          row.appendChild(right);
          frag.appendChild(row);
        });
        lapsEl.innerHTML = '';
        lapsEl.appendChild(frag);
      }

      // Button handlers
      startStopBtn.addEventListener('click', () => {
        if (running) stop(); else start();
      });

      lapBtn.addEventListener('click', () => {
        if (!lapBtn.disabled) recordLap();
      });

      resetBtn.addEventListener('click', reset);

      // Keyboard: Space => start/stop, L => lap, R => reset
      window.addEventListener('keydown', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          if (running) stop(); else start();
        } else if (e.key === 'l' || e.key === 'L') {
          if (!lapBtn.disabled) recordLap();
        } else if (e.key === 'r' || e.key === 'R') {
          reset();
        }
      });

      // Initialize
      reset();
    })();
  </script>
</body>
</html>
